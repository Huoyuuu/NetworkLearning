# 应用层

- [应用层](#应用层)
  - [1. 网络应用原理](#1-网络应用原理)
    - [1.1 网络应用体系结构](#11-网络应用体系结构)
    - [1.2 进程通信](#12-进程通信)
      - [1.2.1 客户端与服务端](#121-客户端与服务端)
      - [1.2.2 进程与计算机网络之间的接口](#122-进程与计算机网络之间的接口)
      - [1.2.3 进程寻址](#123-进程寻址)
    - [1.3 可供应用程序使用的运输服务](#13-可供应用程序使用的运输服务)
    - [1.4 因特网提供的运输服务](#14-因特网提供的运输服务)
      - [1.4.1 TCP](#141-tcp)
      - [1.4.2 UDP](#142-udp)
      - [1.4.3 TCP和UDP均不提供吞吐量和定时方面的保证](#143-tcp和udp均不提供吞吐量和定时方面的保证)
    - [1.5 应用层协议](#15-应用层协议)
    - [1.6 本书涉及的应用程序](#16-本书涉及的应用程序)
  - [2. Web和HTTP](#2-web和http)
    - [2.1 HTTP概况](#21-http概况)
      - [2.2 非持续连接和持续连接](#22-非持续连接和持续连接)
        - [2.2.1 非持续连接](#221-非持续连接)
      - [2.3 报文格式](#23-报文格式)
        - [2.3.1 请求报文](#231-请求报文)
        - [2.3.2 响应报文](#232-响应报文)
      - [2.4 用户与服务器的交互](#24-用户与服务器的交互)
      - [2.5 Web缓存](#25-web缓存)
      - [2.6 条件GET](#26-条件get)
  - [3. 因特网上的电子邮件](#3-因特网上的电子邮件)
  - [4. DNS——互联网的目录服务](#4-dns互联网的目录服务)
  - [5. 点对点文件分发](#5-点对点文件分发)
  - [6. 视频流和内容分发网络](#6-视频流和内容分发网络)
  - [7. 套接字编程：创建网络应用程序](#7-套接字编程创建网络应用程序)
  - [8. 总结](#8-总结)
  - [9. 家庭作业和问题](#9-家庭作业和问题)
  - [10. Wireshark实验 HTTPS、DNS](#10-wireshark实验-httpsdns)


## 1. 网络应用原理

### 1.1 网络应用体系结构
客户端-服务端模式的例子：
    
1. HTTP（超文本传输协议）- HTTP 是一种用于通过 Internet 传输和接收网页的协议。 Web 浏览器和服务器使用它来交换信息并允许用户查看网站。 当用户在浏览器中输入网站的 URL 时，浏览器会向托管该网站的服务器发送 HTTP 请求。 服务器响应 HTTP 响应，其中包含请求的网页。

2. FTP（文件传输协议）- FTP 是一种用于通过网络传输文件的协议。 它通常用于从远程服务器上传和下载文件。 FTP 客户端，例如 FileZilla，可用于连接到 FTP 服务器并传输文件。 客户端和服务器建立连接，然后客户端可以向服务器发送命令，例如上传或下载文件的请求。
   
3. DNS（域名系统）- DNS 是一种用于将域名（例如 www.google.com）转换为 IP 地址的协议。 当用户在浏览器中输入域名时，浏览器会向 DNS 服务器发送 DNS 请求，然后 DNS 服务器返回相应的 IP 地址。 这允许浏览器连接到正确的服务器并访问所需的网站。

P2P模式的例子：

1. BitTorrent - BitTorrent 是一种 P2P 文件共享协议，允许用户相互共享大文件，例如电影和软件。 当用户想要下载文件时，他们会连接到多个拥有该文件的对等点，并从每个对等点下载文件的片段。 这允许高效和快速的下载，因为使用多个源来下载文件。

客户端-服务端与P2P模式的属性对比
| 专题       | 客户端-服务器                  | 点对点                                         |
| ---------- | ------------------------------ | ---------------------------------------------- |
| 结构       | 集中                           | 去中心化                                       |
| 节点关系   | 客户端和服务器                 | 地位平等                                       |
| 负责内容   | 服务器负责存储和处理数据       | 所有节点负责存储和处理数据                     |
| 可扩展性   | 随着客户数量的增加可能成为瓶颈 | 可以更轻松地扩展，因为所有节点都是平等的       |
| 可靠性     | 取决于中央服务器的可靠性       | 更可靠，而且没有单点故障                       |
| 安全       | 中央服务器是潜在的攻击目标     | 更安全，因为所有节点都是平等的，没有中心攻击点 |
| 资源利用   | 服务器比客户端需要更多的资源   | 资源均匀分布在所有节点                         |
| 数据所有权 | 数据归服务器所有               | 数据由存储它的节点拥有                         |
| 控制       | 由服务器进行集中控制           | 去中心化控制由所有节点执行                     |

### 1.2 进程通信

本地不同进程之间的通信问题由操作系统解决，不同终端间进程通信问题由计算机网络方面的设计解决。

#### 1.2.1 客户端与服务端

发起通信的进程是客户端，等待联系的进程是服务端

#### 1.2.2 进程与计算机网络之间的接口

进程通过套接字的软件接口向网络发送报文和从网络接收报文。
套接字就是进程与计算机网络之间的API

#### 1.2.3 进程寻址

报文中需要附带目标主机的地址和对应接收进程的标识符，比如网页端口一般为80，SMTP端口一般为25等

### 1.3 可供应用程序使用的运输服务

从四个方面入手，对应用程序服务要求进行分类：可靠数据传输、吞吐量、定时和安全性

- 可靠数据传输：保证对方能完好无损地接收信息，如用户的账号密码、金融邮件的交易数字等。
- 吞吐量：对于带宽敏感应用（如网络电话，吞吐量低于编码率会导致严重的卡顿问题），需要较高的吞吐量，弹性应用则相对需求不高。
- 定时：提供定时保证，如视频会议、网络游戏等，保证数据在限定时间内发送完毕。
- 安全性：加解密保证信息不会泄露，同时还有数据完整性和端点鉴别等安全保障

### 1.4 因特网提供的运输服务

在因特网（TCP/IP网络）中，提供由TCP和UDP两种运输协议

#### 1.4.1 TCP

- 建立连接：TCP会在客户端和服务端之间建立连接，此时双方均可发送信息。
- 可靠数据传输：TCP可以保证数据按顺序、无误地发送到目的地
- 堵塞控制机制：在发生网络堵塞时，可以自动抑制发送进程，缓解堵塞问题

> TCP的加强版——SSL
> 注意SSL并非是第三种运输协议，而只是TCP协议的加强版
> 使用使用SSL时，向SSL的套接字接口发送明文数据即可。

#### 1.4.2 UDP

- 轻量级运输协议，没有握手过程
- 不保证数据按顺序抵达，也不保证数据完全抵达
- 没有堵塞控制机制

#### 1.4.3 TCP和UDP均不提供吞吐量和定时方面的保证

TCP和UDP均不提供吞吐量和定时方面的保证，但在设计时尽量应对这种保证的缺乏，实际使用运行良好

### 1.5 应用层协议

应用层协议定义了：
- 交换的报文类型，如请求报文和响应报文。
- 各种报文类型的语法，如报文中的各个字段和字段是如何描述的
- 字段信息的含义。
- 确定一个进程何时以及如何发送报文，并对报文进行相应的规则

> 需要注意的是，应用层协议只是网络应用的一部分，并非独立关系。

### 1.6 本书涉及的应用程序

5种应用：Web、文件传输、电子邮件、目录服务、流视频和P2P

## 2. Web和HTTP

### 2.1 HTTP概况
Web应用层协议——HTTP超文本传输协议
HTTP的运输层协议为TCP
HTTP为无状态协议，不记录用户信息（通过cookie验证是哪位用户）

#### 2.2 非持续连接和持续连接

##### 2.2.1 非持续连接
必须为每一个请求对象建立一个单独的TCP连接
每次请求响应时间为两次RTT+服务器传输HTML文件用#### 2.2.2 持续连接
建立持续连接，请求对象通过相同的TCP连接进行传输

#### 2.3 报文格式

##### 2.3.1 请求报文

首行为请求行，标注方法字段、URL字段和HTTP版本字段
其次为首部行。

方法字段：GET请求、POST发送、PUT上传对象、DELETE删除对象、HEAD类似GET但不发送请求对象，一般用于调试跟踪

一般用POST发送表单信息，但是GET也支持这样的操作，直接修改链接即可，比如/search?monkey&bananas

##### 2.3.2 响应报文
首行为状态行，标注HTTP版本字段、状态码和相应的状态信息，如HTTP/1.1  200  OK
之后为若干首部行，
最后是数据行，表示传输的数据

#### 2.4 用户与服务器的交互

用户首次访问，服务器给用户创建cookie，将数据保留在后端的数据库中，然后将cookie发给用户，用户在本地存下cookie。
用户再次访问，发送请求时携带cookie信息，服务器调用后端数据库确认用户身份，然后展示对应内容。

#### 2.5 Web缓存
代理服务器，实际使用时服务器通过建立多个代理缓解网络时延和吞吐量的问题，CDN（内容分发网络）通过在不同的地理位置建立代理服务器大大缓解大量请求流量带来的问题。
对于用户来说，请求到的对象可能并非是服务器本身，而是众多代理服务器的其中一个。

#### 2.6 条件GET
解决代理服务器和原始服务器间文件不同步问题。
用户请求文件时，代理服务器向原始服务器发送条件GET，判断文件是否是最新状态（是否从xxx时间点后修改过）
如果是最新状态，原始服务器发送的响应报文中只含头部文件即可，如果不是，则返回对应的最新对象
接受服务器反馈后，代理服务器将对象传输给用户，并可以保证其为最新状态。

整个处理思路最神奇的地方在于，原本需要传输整个对象，现在只需要传输一次，之后每次只需传输“是否更新过”这个信息即可。

## 3. 因特网上的电子邮件
## 4. DNS——互联网的目录服务
## 5. 点对点文件分发
## 6. 视频流和内容分发网络
## 7. 套接字编程：创建网络应用程序
## 8. 总结
## 9. 家庭作业和问题
## 10. Wireshark实验 HTTPS、DNS